
git_clone_pull ()
{
  local dest=$1
  local repo=$2
  local ref=${3:-main}

  if [ -d "$dest/.git" ]; then
    git -C "$dest" checkout $ref
    git -C "$dest" pull --ff-only
  else
    git clone "$repo" "$dest" 
    git -C "$dest" checkout $ref
  fi
}

create_shim ()
{
  local src=$1
  local dest=$2

  cat > $dest <<EOF
#!/bin/sh
# Autogenerated shim for asdf
exec $src \$@
EOF
  chmod +x "$dest"
}


xsh_install_asdf_git ()
{
  local version=v0.11.3

  local repo="https://github.com/asdf-vm/asdf.git"
  local dest_git="$HOME/.local/shell/asdf"
  local dest_bin="$HOME/.local/bin/asdf"

  # DISABLE: advice.detachedHead
  git_clone_pull "$dest_git" "$repo" $version
  mkdir -p "$HOME/.config/xsh"
  create_shim "$dest_git/bin/asdf" "$dest_bin"

}


xsh_install_asdf_git
>&2 echo "asdf has been installed"
